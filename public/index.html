<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KazuChar.AI - Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-dark: #0f0f1a; --bg-card: #1a1a2e; --bg-input: #252542; --accent: #6c5ce7; --accent-light: #a29bfe; --text: #ffffff; --text-muted: #8888aa; --border: rgba(255,255,255,0.1); }
        * { font-family: 'Poppins', sans-serif; box-sizing: border-box; }
        body { background: linear-gradient(135deg, var(--bg-dark) 0%, #16213e 50%, #1a1a2e 100%); min-height: 100vh; color: var(--text); margin: 0; overflow-x: hidden; }
        .glass-card { background: rgba(26, 26, 46, 0.9); backdrop-filter: blur(20px); border: 1px solid var(--border); border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.4); }
        .logo-icon { width: 80px; height: 80px; background: linear-gradient(135deg, var(--accent), var(--accent-light)); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 20px; box-shadow: 0 12px 35px rgba(108,92,231,0.4); animation: float 4s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
        .form-control, .form-select { background: var(--bg-input); border: 1px solid var(--border); color: var(--text); padding: 14px 18px; border-radius: 12px; font-size: 14px; }
        .form-control:focus, .form-select:focus { background: var(--bg-input); border-color: var(--accent); color: var(--text); box-shadow: 0 0 0 3px rgba(108,92,231,0.15); }
        .form-control::placeholder { color: var(--text-muted); }
        .form-label { color: var(--text-muted); font-size: 12px; font-weight: 600; margin-bottom: 8px; }
        .btn-primary { background: linear-gradient(135deg, var(--accent), var(--accent-light)); border: none; padding: 14px 28px; border-radius: 12px; font-weight: 700; font-size: 15px; box-shadow: 0 8px 25px rgba(108,92,231,0.4); }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(108,92,231,0.5); }
        .nav-tabs { border: none; background: var(--bg-input); border-radius: 14px; padding: 6px; }
        .nav-tabs .nav-link { border: none; color: var(--text-muted); border-radius: 10px; padding: 12px 24px; font-weight: 600; font-size: 14px; }
        .nav-tabs .nav-link.active { background: linear-gradient(135deg, var(--accent), var(--accent-light)); color: white; box-shadow: 0 6px 20px rgba(108,92,231,0.4); }
        .form-check-input { background-color: var(--bg-input); border: 1px solid var(--border); width: 20px; height: 20px; }
        .form-check-input:checked { background-color: var(--accent); border-color: var(--accent); }
        .form-check-label { color: var(--text-muted); font-size: 13px; margin-left: 8px; }
        .link-accent { color: var(--accent-light); text-decoration: none; font-weight: 500; font-size: 13px; }
        .link-accent:hover { color: white; }
        .alert { border-radius: 12px; border: none; font-size: 13px; }
        .modal-content { background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; }
        .modal-header { border-bottom: 1px solid var(--border); }
        .modal-footer { border-top: 1px solid var(--border); }
        .btn-close { filter: invert(1); }
        .input-group .btn { border-radius: 0 12px 12px 0 !important; background: var(--bg-input); border: 1px solid var(--border); border-left: none; color: var(--text-muted); }
        .input-group .form-control { border-right: none; border-radius: 12px 0 0 12px !important; }
        .btn-outline-secondary { background: var(--bg-input); border: 1px solid var(--border); color: var(--text-muted); border-radius: 12px; }
        .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; z-index: 0; }
        .particle { position: absolute; background: var(--accent); border-radius: 50%; opacity: 0.1; animation: rise 20s infinite; }
        @keyframes rise { 0% { transform: translateY(100vh) rotate(0deg); opacity: 0; } 20% { opacity: 0.15; } 80% { opacity: 0.15; } 100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; } }
        @media (max-width: 576px) { .glass-card { margin: 12px; padding: 20px !important; border-radius: 20px; } .logo-icon { width: 70px; height: 70px; font-size: 35px; } .nav-tabs .nav-link { padding: 10px 18px; font-size: 13px; } }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    <div class="container d-flex align-items-center justify-content-center min-vh-100 py-4 position-relative" style="z-index:1;">
        <div class="glass-card p-4" style="width: 100%; max-width: 440px;">
            <div class="text-center mb-4">
                <div class="logo-icon">ðŸŽ­</div>
                <h1 class="h3 fw-bold mb-1">Kazu<span style="color:var(--accent-light)">Char</span>.AI</h1>
                <p class="text-muted small mb-0">AI Character Roleplay Platform</p>
            </div>
            <ul class="nav nav-tabs nav-justified mb-4" role="tablist">
                <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#login"><i class="bi bi-box-arrow-in-right me-1"></i>Login</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#register"><i class="bi bi-person-plus me-1"></i>Register</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="login">
                    <form id="loginForm">
                        <div class="mb-3"><label class="form-label"><i class="bi bi-envelope me-1"></i>Email/Username</label><input type="text" class="form-control" id="loginEmail" placeholder="Email atau username" required></div>
                        <div class="mb-3"><label class="form-label"><i class="bi bi-lock me-1"></i>Password</label><div class="input-group"><input type="password" class="form-control" id="loginPassword" placeholder="Password" required><button class="btn" type="button" onclick="togglePassword('loginPassword', this)"><i class="bi bi-eye"></i></button></div></div>
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div class="form-check"><input type="checkbox" class="form-check-input" id="remember"><label class="form-check-label" for="remember">Ingat saya</label></div>
                            <a href="#" class="link-accent" data-bs-toggle="modal" data-bs-target="#forgotModal">Lupa password?</a>
                        </div>
                        <button type="submit" class="btn btn-primary w-100"><i class="bi bi-arrow-right-circle me-2"></i>Masuk</button>
                    </form>
                </div>
                <div class="tab-pane fade" id="register">
                    <form id="registerForm">
                        <div class="mb-3"><label class="form-label"><i class="bi bi-person me-1"></i>Nama</label><input type="text" class="form-control" id="regName" placeholder="Nama lengkap" required></div>
                        <div class="mb-3"><label class="form-label"><i class="bi bi-at me-1"></i>Username (opsional)</label><input type="text" class="form-control" id="regUsername" placeholder="username"></div>
                        <div class="mb-3"><label class="form-label"><i class="bi bi-envelope me-1"></i>Email</label><input type="email" class="form-control" id="regEmail" placeholder="email@example.com" required></div>
                        <div class="mb-3"><label class="form-label"><i class="bi bi-lock me-1"></i>Password</label><div class="input-group"><input type="password" class="form-control" id="regPassword" placeholder="Min 6 karakter" required minlength="6"><button class="btn" type="button" onclick="togglePassword('regPassword', this)"><i class="bi bi-eye"></i></button></div></div>
                        <div class="mb-4" id="ageVerifySection"><div class="form-check"><input type="checkbox" class="form-check-input" id="ageVerified"><label class="form-check-label" for="ageVerified"><i class="bi bi-shield-check me-1"></i>Saya 18+ tahun</label></div></div>
                        <button type="submit" class="btn btn-primary w-100"><i class="bi bi-person-plus me-2"></i>Daftar</button>
                    </form>
                </div>
            </div>
            <div id="alertBox" class="mt-4"></div>
        </div>
    </div>
    <div class="modal fade" id="forgotModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" style="font-size:15px;"><i class="bi bi-key me-2"></i>Lupa Password</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p class="text-muted small">Masukkan email dan admin akan membantu reset password.</p><input type="email" class="form-control" id="forgotEmail" placeholder="Email terdaftar"></div><div class="modal-footer"><button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal">Batal</button><button type="button" class="btn btn-primary btn-sm" onclick="forgotPassword()"><i class="bi bi-send me-1"></i>Kirim</button></div></div></div></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API = window.location.origin + '/api';
        const particlesContainer = document.getElementById('particles');
        for (let i = 0; i < 40; i++) { const p = document.createElement('div'); p.className = 'particle'; p.style.left = Math.random() * 100 + '%'; p.style.animationDelay = Math.random() * 20 + 's'; p.style.animationDuration = (15 + Math.random() * 15) + 's'; p.style.width = p.style.height = (3 + Math.random() * 6) + 'px'; particlesContainer.appendChild(p); }
        function togglePassword(id, btn) { const input = document.getElementById(id); const icon = btn.querySelector('i'); input.type = input.type === 'password' ? 'text' : 'password'; icon.classList.toggle('bi-eye'); icon.classList.toggle('bi-eye-slash'); }
        function showAlert(msg, type = 'danger') { document.getElementById('alertBox').innerHTML = `<div class="alert alert-${type} alert-dismissible fade show"><i class="bi bi-${type === 'success' ? 'check-circle' : 'exclamation-circle'}-fill me-2"></i>${msg}<button type="button" class="btn-close btn-sm" data-bs-dismiss="alert"></button></div>`; }
        fetch(API + '/settings/public').then(r => r.json()).then(d => { if (!d.nsfw_registration) document.getElementById('ageVerifySection').style.display = 'none'; }).catch(() => {});
        document.getElementById('loginForm').addEventListener('submit', async (e) => { e.preventDefault(); const btn = e.target.querySelector('button[type="submit"]'); const orig = btn.innerHTML; btn.disabled = true; btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Loading...'; try { const res = await fetch(API + '/auth/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ login: document.getElementById('loginEmail').value, password: document.getElementById('loginPassword').value }) }); const data = await res.json(); if (data.token) { localStorage.setItem('kazuchar_token', data.token); localStorage.setItem('kazuchar_user', JSON.stringify(data.user)); showAlert('ðŸŽ‰ Login berhasil!', 'success'); setTimeout(() => window.location.href = '/dashboard.html', 800); } else showAlert(data.error || 'Login gagal'); } catch { showAlert('Kesalahan koneksi'); } btn.disabled = false; btn.innerHTML = orig; });
        document.getElementById('registerForm').addEventListener('submit', async (e) => { e.preventDefault(); const btn = e.target.querySelector('button[type="submit"]'); const orig = btn.innerHTML; btn.disabled = true; btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Loading...'; try { const res = await fetch(API + '/auth/register', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name: document.getElementById('regName').value, username: document.getElementById('regUsername').value || null, email: document.getElementById('regEmail').value, password: document.getElementById('regPassword').value, age_verified: document.getElementById('ageVerified').checked }) }); const data = await res.json(); if (data.success) { showAlert('ðŸŽ‰ ' + data.message, 'success'); e.target.reset(); } else showAlert(data.error); } catch { showAlert('Kesalahan koneksi'); } btn.disabled = false; btn.innerHTML = orig; });
        async function forgotPassword() { const email = document.getElementById('forgotEmail').value; if (!email) { showAlert('Masukkan email', 'warning'); return; } try { const res = await fetch(API + '/auth/forgot-password', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ login: email }) }); const data = await res.json(); bootstrap.Modal.getInstance(document.getElementById('forgotModal')).hide(); showAlert(data.message || data.error, data.success ? 'success' : 'danger'); } catch { showAlert('Kesalahan'); } }
        if (localStorage.getItem('kazuchar_token')) window.location.href = '/dashboard.html';
    </script>
</body>
</html>
